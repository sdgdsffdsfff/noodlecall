var __extends=this.__extends||function(e,t){function n(){this.constructor=e}n.prototype=t.prototype,e.prototype=new n},wijmo;(function(e){(function(t){"use strict";var n=jQuery,r="wijdatepager",i="wijmo-wijdatepager",s="wijmo-wijdatepager-increment",o="wijmo-wijdatepager-decrement",u="wijmo-wijdatepager-container",a="wijmo-wijdatepager-pages",f="wijmo-wijdatepager-pagelabel",l="wijmo-wijdatepager-pagelabel-first",c="wijmo-wijdatepager-pagelabel-last",h="wijmo-wijdatepager-pageheader",p="wijmo-wijdatepager-pagerange",d="wijmo-wijdatepager-tooltip",v="wijmo-wijdatepager-tooltip-inner",m="wijmo-wijdatepager-triangle",g="wijmo-wijdatepager-width-smallest",y="wijmo-wijdatepager-width-small",b="wijmo-wijdatepager-width-medium",w="wijmo-wijdatepager-width-normal",E=function(e){function t(){e.apply(this,arguments)}return __extends(t,e),t.prototype._setOption=function(e,t){n.wijmo.widget.prototype._setOption.apply(this,arguments);switch(e){case"culture":this.options.culture=t,this._initBackground();break;case"selectedDate":this.options.selectedDate=t,this._initBackground();break;case"disabled":t?this._disable():this._enable();break;case"viewType":this.options.viewType=t,this._initBackground();break;case"nextTooltip":this.element.find("."+s).attr("title",t);break;case"prevTooltip":this.element.find("."+o).attr("title",t);break;case"firstDayOfWeek":this.options.firstDayOfWeek=t,this.options.viewType==="week"&&this._initBackground()}return this},t.prototype._disable=function(){this.element.addClass(this.options.wijCSS.stateDisabled),this.element.find("."+o).button("option","disabled",!0),this.element.find("."+s).button("option","disabled",!0)},t.prototype._enable=function(){this.element.removeClass(this.options.wijCSS.stateDisabled),this.element.find("."+o).button("option","disabled",!1),this.element.find("."+s).button("option","disabled",!1)},t.prototype._create=function(){var e=this.options,t,r,f;window.wijmoApplyWijTouchUtilEvents&&(n=window.wijmoApplyWijTouchUtilEvents(n)),e.selectedDate||(e.selectedDate=new Date),this._dtpagernamespacekey="dtpager"+(new Date).getTime(),this.element.addClass(i).addClass(e.wijCSS.wijdatepager).addClass(e.wijCSS.widget).addClass(e.wijCSS.helperClearFix),t=n.proxy(this.invalidate,this),n(window).bind("resize."+this._dtpagernamespacekey,t),this.element.disableSelection&&this.element.disableSelection(),this.element.append(n("<a></a>").addClass(o).addClass(e.wijCSS.wijdatepagerDecButton).append(n("<span>"+e.prevTooltip+"</span>"))).append(n("<div></div>").addClass(u).addClass(e.wijCSS.wijdatepagerContainer).addClass(e.wijCSS.content).append(n("<div></div>").addClass(a).addClass(e.wijCSS.wijdatepagerPages))).append(n("<a></a>").addClass(s).addClass(e.wijCSS.wijdatepagerIncButton).append(n("<span>"+e.nextTooltip+"</span>"))),n.wijmo.widget.prototype._create.apply(this,arguments),r=this.element.find("."+o),f=this.element.find("."+s),n.mobile==null?(r.button({icons:{primary:e.wijCSS.iconArrowLeft},text:!1}),f.button({icons:{primary:e.wijCSS.iconArrowRight},text:!1})):(r.html(""),r.attr("data-icon","arrow-l"),r.button({text:!1}),f.html(""),f.attr("data-icon","arrow-r"),f.button({text:!1})),r.click(n.proxy(this.goLeft,this)),f.click(n.proxy(this.goRight,this)),this._initBackground(),e.disabled&&this._disable()},t.prototype.destroy=function(){this.element.removeClass(i).removeClass(this.options.wijCSS.wijdatepager),n(window).unbind("."+this._dtpagernamespacekey)},t.prototype.refresh=function(){this.invalidate()},t.prototype.invalidate=function(){var e,t=this.options,r=t.selectedDate,i,l=this.element.find("."+u),c=this.element.find("."+o),h=this.element.find("."+s),p=this.element.innerWidth(),d=c.is(":visible")?c.outerWidth(!0):0,v=h.is(":visible")?h.outerWidth(!0):0,m,E,S;e=this.element.find("."+f+"."+this._getDateClass(r)),e.length!==1?e=n(this.element.find("."+f)[this._index]):(i=this.element.find("."+f).index(e),this._index=i),this.element.find("."+f+"."+t.wijCSS.stateActive).removeClass(t.wijCSS.stateActive),e.addClass(this.options.wijCSS.stateActive),l.css("left",d),this.element.removeClass(g).removeClass(t.wijCSS.wijdatepagerWidthSmallest).removeClass(y).removeClass(t.wijCSS.wijdatepagerWidthSmall).removeClass(b).removeClass(t.wijCSS.wijdatepagerWidthMedium).removeClass(w).removeClass(t.wijCSS.wijdatepagerWidthNormal),p<300?this.element.addClass(g).addClass(t.wijCSS.wijdatepagerWidthSmallest):p<475?this.element.addClass(y).addClass(t.wijCSS.wijdatepagerWidthSmall):p<600?this.element.addClass(b).addClass(t.wijCSS.wijdatepagerWidthMedium):this.element.addClass(w).addClass(t.wijCSS.wijdatepagerWidthNormal),l.outerWidth(p-d-v),n.browser.msie&&parseInt(n.browser.version,10)<=7&&(m=this.element.find("."+a),E=m.find("."+f),S=Math.round(m.width()/this._datesDef.length)-(E.outerWidth(!0)-E.width()),E.width(S))},t.prototype.goLeft=function(e){var t=this.options;if(t.disabled)return;this._setSelectedIndex(this._index-1,!0);if(e)return e.preventDefault(),!1},t.prototype.goRight=function(){var e=this.options;if(e.disabled)return;this._setSelectedIndex(this._index+1)},t.prototype._getCulture=function(e){return typeof e=="undefined"&&(e=null),Globalize.findClosestCulture(e||this.options.culture)},t.prototype._isRTL=function(){return!!this._getCulture().isRTL},t.prototype._initBackground=function(e,t){typeof e=="undefined"&&(e=!1),typeof t=="undefined"&&(t=!1);var r=this,i,s,o,u,d,v=this,m=v.options,g,y=n("<div></div>");if(this._isInAnimate)return;this._index=0,this._datesDef=this._getDatesDefinition(),this._min=0,this._max=this._datesDef.length-1,n.each(this._datesDef,function(e,t){var i=n("<div>"+r._datesDef[e].l+"</div>").addClass(f).addClass(m.wijCSS.wijdatepagerPageLabel).addClass(r._getDateClass(t.d));e===0&&i.addClass(l).addClass(m.wijCSS.wijdatepagerPageLabelFirst),t.range&&i.addClass(p).addClass(m.wijCSS.wijdatepagerPageRange),t.header&&i.addClass(h).addClass(m.wijCSS.wijdatepagerPageHeader).addClass(m.wijCSS.stateHightlight),e===r._max&&i.addClass(c).addClass(m.wijCSS.wijdatepagerPageLabelLast),y.append(i)}),i=y.html(),o=this.element.find("."+a),e?(this._isInAnimate=!0,s=o.clone(!0),o.html(i),u=o.find("."+f),t?(s.insertAfter(o),d=n(u[this._index]).offset().left,o.css("opacity",0).css("left",-s.outerWidth(!0)).stop().animate({left:"0px",opacity:100}),s.css("left",0).stop().animate({left:s.outerWidth(!0)+"px",opacity:0},function(){s.remove(),v._isInAnimate=!1,v.invalidate()})):(s.insertBefore(o),d=n(u[this._index]).offset().left,o.css("opacity",0).css("left",s.outerWidth(!0)).stop().animate({left:"0px",opacity:100}),s.stop().animate({left:"-"+s.outerWidth(!0)+"px",opacity:0},function(){s.remove(),v._isInAnimate=!1,v.invalidate()}))):(o.html(i),this.invalidate()),u=o.find("."+f),u.hover(n.proxy(this._pagelabelHover,this),n.proxy(this._pagelabelHout,this)),u.bind("mousedown",n.proxy(this._pagelabelMouseDown,this)),u.click(n.proxy(function(e){var t=n(e.target),r;r=this.element.find("."+f).index(t),this._setSelectedIndex(r)},this))},t.prototype._getDateClass=function(e){return"c1dt"+e.getFullYear()+"_"+e.getMonth()+"_"+e.getDate()},t.prototype._addDays=function(e,t){return new Date(e.getFullYear(),e.getMonth(),e.getDate()+t)},t.prototype._getDatesDefinition=function(){var e=this.options,t=e.viewType.toLowerCase(),n,r,i,s,o,u=[],a=e.selectedDate;switch(t){case"week":i=new Date(a.getFullYear(),a.getMonth(),-6),n=e.firstDayOfWeek-i.getDay(),Math.abs(n)>6&&(n=i.getDay()-e.firstDayOfWeek),i=this._addDays(i,n),o=new Date(a.getFullYear(),a.getMonth()+1,7),n=0;while(i<o||i.getMonth()===a.getMonth())s=this._addDays(i,7),u.push({l:this._formatString(this.localizeString("weekViewLabelFormat","{0:MMM dd}-{1:dd}"),i,this._addDays(i,6)),d:i,d2:this._addDays(i,6)}),a>=i&&a<=s&&(this._index=n),i=s,n+=1;break;case"month":r=new Date(a.getFullYear()-1,0,1),u.push({l:r.getFullYear(),d:r,range:!0}),r=new Date(a.getFullYear(),0,1),u.push({l:r.getFullYear(),d:r,header:!0});for(n=0;n<12;n+=1)r=new Date(a.getFullYear(),n,1),u.push({l:this._formatString(this.localizeString("monthViewLabelFormat","{0:MMM}"),r),d:r}),s=new Date(a.getFullYear(),n+1,1),a>=r&&a<=s&&(this._index=n+2);r=new Date(a.getFullYear()+1,0,1),u.push({l:r.getFullYear(),d:r,range:!0});break;default:r=new Date(a.getFullYear(),a.getMonth(),0),u.push({l:Globalize.format(r,"MMM",this._getCulture()),d:r,range:!0}),r=new Date(a.getFullYear(),a.getMonth(),1),u.push({l:Globalize.format(r,"MMM",this._getCulture()),d:r,header:!0}),i=r,n=2;while(i.getMonth()===a.getMonth())s=new Date(i.getFullYear(),i.getMonth(),i.getDate()+1),u.push({l:this._formatString(this.localizeString("dayViewLabelFormat","{0:d }"),i),d:i}),a>=i&&a<=s&&(this._index=n),i=s,n+=1;r=new Date(a.getFullYear(),a.getMonth()+1,1),u.push({l:Globalize.format(r,"MMM",this._getCulture()),d:r,range:!0})}return u},t.prototype._setSelectedIndex=function(e,t){typeof t=="undefined"&&(t=!1);var n=this.options,r;if(n.disabled)return;if(e>=this._min&&e<=this._max){this._dragActivated&&this._showTooltip(e);if(this._index!==e){if(this._datesDef[e].header){if(!t)return;e-=1}this._index=e,r=this._datesDef[e].d,n.selectedDate=r,this._max>2&&this._index===0?this._initBackground(!0,!0):this._index===this._max?(n.viewType==="week"&&(n.selectedDate=new Date(n.selectedDate.getFullYear(),n.selectedDate.getMonth(),n.selectedDate.getDate()+7)),this._initBackground(!0,!1),n.selectedDate=r):this.invalidate(),this._trigger("selectedDateChanged",null,{selectedDate:n.selectedDate})}}},t.prototype._pagelabelHover=function(e){var t=n(e.target),r=this.options;if(t.hasClass(h))return;t.addClass(r.wijCSS.stateHover)},t.prototype._showTooltip=function(e){var t=this.options,r=this._datesDef[e],i=t.viewType,s,o=this.element.find("."+f)[e];this._tooltip||(this._tooltip=n("<div></div>").addClass(d).addClass(t.wijCSS.wijdatepagerTooltip).append(n("<div></div>").addClass(v).addClass(t.wijCSS.wijdatepagerTooltipInner)).append(n("<div></div>").addClass(m).addClass(t.wijCSS.wijdatepagerTriangle)),this.element.append(this._tooltip),this._tooltip.wijpopup()),s="";switch(i){case"week":r.d.getMonth()!==r.d2.getMonth()?s=this._formatString(this.localizeString("weekViewTooltip2MonthesFormat","{0:MMMM d} - {1:MMMM d, yyyy}"),r.d,r.d2):s=this._formatString(this.localizeString("weekViewTooltipFormat","{0:MMMM d} - {1:d, yyyy}"),r.d,r.d2);break;case"month":s=this._formatString(this.localizeString("monthViewTooltipFormat","{0:MMMM yyyy}"),r.d);break;default:s=this._formatString(this.localizeString("dayViewTooltipFormat","{0:dddd, MMMM d, yyyy}"),r.d)}n.ui&&(this._tooltip.wijpopup("show",{of:o,my:"center bottom",at:"center top",offset:"-10 -10"}),this._tooltip.find("."+v).html(s))},t.prototype._hideTooltip=function(){this._tooltip.wijpopup("hide")},t.prototype._pagelabelHout=function(e){n(e.target).removeClass(this.options.wijCSS.stateHover)},t.prototype._pagelabelMouseDown=function(e){this._dragActivated=!1;if(this.options.disabled)return;e.preventDefault();var t=n(e.target),r;if(t.hasClass(h))return;r=this.element.find("."+f).index(t),this._dragActivated=!0,this._setSelectedIndex(r),this._mouseDownTimeFix20555=(new Date).getTime(),this._startClientX=e.pageX,this._startInd=r,n(document).bind("mousemove."+this._dtpagernamespacekey,n.proxy(this._pageindicatorMouseMove,this)),n(document).bind("mouseup."+this._dtpagernamespacekey,n.proxy(this._pageindicatorMouseUp,this))},t.prototype._detectLeftButton=function(e){return e.originalEvent&&(e=e.originalEvent),"buttons"in e?e.buttons===1:"which"in e?e.which===1:e.button===1},t.prototype._pageindicatorMouseMove=function(e){if(!this._detectLeftButton(e)){this._pageindicatorMouseUp();return}e.preventDefault();if(this._isInAnimate)return;var t=this.element.find("."+f)[this._startInd],n,r;if(!t)return;n=t.offsetLeft+Math.round(t.offsetWidth/2)+(e.pageX-this._startClientX),r=this._findClosesPageIndexByPos(n);if(this._prevMoveInd===r)return;this._prevMoveInd=r;if(this._mouseDownTimeFix20555+150>(new Date).getTime())return;r!==-1&&r!==this._index&&this._setSelectedIndex(r)},t.prototype._pageindicatorMouseUp=function(){this._dragActivated=!1,n(document).unbind("."+this._dtpagernamespacekey),this._hideTooltip()},t.prototype._findClosesPageIndexByPos=function(e){var t=this.element.find("."+a).find("."+f),n;for(n=0;n<t.length;n+=1)if(t[n].offsetLeft<e&&t[n].offsetLeft+t[n].offsetWidth>e)return n;return-1},t.prototype.localizeString=function(e,t){var n=this.options;return n.localization&&n.localization[e]?n.localization[e]:t},t.prototype._formatString=function(e,t,n,r){var i,s=arguments,o,u,a=this;if(s.length<=1)return Globalize.format(s);typeof e=="string"&&typeof window[e]=="function"&&(e=window[e]);if(typeof e=="function"){u=[];for(o=1;o<s.length;o+=1)u[o-1]=s[o];return e.apply(this,u)}return i=new RegExp("\\{(\\d+)(?:,([-+]?\\d+))?(?:\\:([^(^}]+)(?:\\(((?:\\\\\\)|[^)])+)\\)){0,1}){0,1}\\}","g"),e.replace(i,function(e,t,n,r,i){return e=s[Number(t)+1],r?Globalize.format(e,r,a._getCulture()):e})},t}(e.wijmoWidget);t.wijdatepager=E;var S=function(){function e(){this.wijCSS={wijdatepager:"",wijdatepagerIncButton:"",wijdatepagerDecButton:"",wijdatepagerContainer:"",wijdatepagerPages:"",wijdatepagerPageLabel:"",wijdatepagerPageLabelFirst:"",wijdatepagerPageLabelLast:"",wijdatepagerPageHeader:"",wijdatepagerPageRange:"",wijdatepagerTooltip:"",wijdatepagerTooltipInner:"",wijdatepagerTriangle:"",wijdatepagerWidthSmallest:"",wijdatepagerWidthSmall:"",wijdatepagerWidthMedium:"",wijdatepagerWidthNormal:""},this.wijMobileCSS={header:"ui-header ui-bar-a",content:"ui-body ui-body-c",stateDefault:"ui-btn-up-c"},this.initSelector=":jqmData(role='wijdatepager')",this.culture="",this.localization=null,this.firstDayOfWeek=0,this.selectedDate=null,this.viewType="day",this.nextTooltip="right",this.prevTooltip="left",this.selectedDateChanged=null}return e}();E.prototype.options=n.extend(!0,{},e.wijmoWidget.prototype.options,new S),n.wijmo.registerWidget(r,E.prototype)})(e.datepager||(e.datepager={}));var t=e.datepager})(wijmo||(wijmo={}));