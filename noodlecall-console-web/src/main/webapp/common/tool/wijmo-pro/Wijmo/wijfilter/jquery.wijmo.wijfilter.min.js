var __extends=this.__extends||function(e,t){function n(){this.constructor=e}n.prototype=t.prototype,e.prototype=new n},wijmo;(function(e){(function(t){"use strict";var n=jQuery,r=function(e){function t(){e.apply(this,arguments)}return __extends(t,e),t.prototype._create=function(){this._super.apply(this,arguments),this._initialized=!1,this.element.addClass(this.options.wijCSS.widget+" "+"wijmo-wijfilter")},t.prototype._init=function(){this._initialized||this._recreate()},t.prototype._setOptions=function(){this._super.apply(this,arguments);try{this._initialized=!1,this._recreate()}finally{this._initialized=!0}},t.prototype._recreate=function(){var e=this;this._searchTimer=0,this._searchKey=undefined,this._ignoreEvents=!1,this._elements={},this._dialog&&(this._dialog.remove(),this._dialog=null),this.options.filterValue=n.map(this.options.filterValue,function(e,t){return n.isArray(e)?[e]:[[e]]}),this._originalOptions=n.extend(!0,{},{sortDirection:this.options.sortDirection,filterValue:this.options.filterValue,filterOperator:this.options.filterOperator}),this._distinctDataValues=this._getDistinctDataValues(this.options.data,this.options.dataKey),this._distinctDataValuesCI=[],n.each(this._distinctDataValues,function(t,n){e._distinctDataValuesCI.push(typeof n=="string"?n.toLowerCase():n)}),this.element.append(this._dialog=this._createRoughDialog()),this._attachElements(this._distinctDataValues,this.options.availableOperators),this._fillDialog()},t.prototype._destroy=function(){this._dialog&&(this._dialog.remove(),this._dialog=null),this.element.removeClass(this.options.wijCSS.widget+" "+"wijmo-wijfilter")},t.prototype.triggerClose=function(e){this._trigger("close",null,e?{sortDirection:this.options.sortDirection,filterValue:this.options.filterValue,filterOperator:this.options.filterOperator}:null)},t.prototype._getDisplayValue=function(e){return e===null?this.options.nullDisplayText:e},t.prototype._onApplyButtonClick=function(e,t){if(this._isSettingsChanged(this.options,this._originalOptions)){var r=this._elements.$radioButtons.eq(0).is(":checked")?"and":"or";n.each(this.options.filterOperator,function(e,t){t.condition=r}),this.triggerClose(!0)}else this.triggerClose(!1)},t.prototype._onClearButtonClick=function(){this._resetFilterOptions(),this._onApplyButtonClick()},t.prototype._onAscendingButtonClick=function(e,t){var r=n(e.target);r.is(":checked")?(this.options.sortDirection="ascending",this._elements.$descendingBtn.prop("checked",!1).button("refresh")):this.options.sortDirection="none"},t.prototype._onDescendingButtonClick=function(e,t){var r=n(e.target);r.is(":checked")?(this.options.sortDirection="descending",this._elements.$ascendingBtn.prop("checked",!1).button("refresh")):this.options.sortDirection="none"},t.prototype._onCheckboxChange=function(e,t){if(this._ignoreEvents)return;var r=n(e.target),i=r.is(":checked"),s=[],o=this;r.is(".wijmo-wijfilter-selectAll")?this._elements.$checkboxes.each(function(e,t){return e&&n(t).prop("checked",i).wijcheckbox("refresh"),!0}):this._elements.$checkboxes.each(function(e,t){return e?n(t).is(":checked")&&s.push(o._distinctDataValues[e-1]):n(t).prop("checked",!1).wijcheckbox("refresh"),!0}),s.length?(this.options.filterOperator=[{name:"Equals"}],this.options.filterValue=[s]):this._resetFilterOptions(),this._resetFilterArea()},t.prototype._onFilterAreaChanged=function(e,t){if(this._ignoreEvents)return;var r=this;this._resetCheckboxes(),this.options.filterOperator=[{name:this._elements.$filterOperatorsDdl.eq(0).val()},{name:this._elements.$filterOperatorsDdl.eq(1).val()}],this.options.filterValue=n.map(this._elements.$filterValuesDdl,function(e,t){var i=n(e),s=i.wijcombobox("option","selectedIndex");return s>=0?[[r._distinctDataValues[s]]]:[[i.val()||undefined]]})},t.prototype._onRadioButtonChanged=function(e,t){if(this._ignoreEvents)return;var r=this._elements.$radioButtons.eq(0).is(":checked")?"and":"or";n.each(this.options.filterOperator,function(e,t){t.condition=r})},t.prototype._onSearchTextboxKeyUp=function(e,t){if(this._ignoreEvents)return;var n=this;this._searchTimer>0&&window.clearTimeout(this._searchTimer),this._searchTimer!==-1&&(this._searchTimer=window.setTimeout(function(){n._searchTimer=-1;try{n._doSearch(e.target.value)}finally{n._searchTimer=0}},300))},t.prototype._doSearch=function(e){if(this._searchKey!==e)if(!e&&e!==0)this._elements.$checkboxes.closest("li").show();else{var t=[],r=0,i=this;n.each(this._distinctDataValues,function(n,r){r=r||r===0?r.toString().toLowerCase():"",r.indexOf(e)>=0&&t.push(n+1)}),t.length?this._elements.$checkboxes.each(function(e,i){return e&&(e===t[r]?(r++,n(i).closest("li").show()):n(i).closest("li").hide()),!0}):this._elements.$checkboxes.closest("li").hide()}this._searchKey=e},t.prototype._resetFilters=function(){try{this._ignoreEvents=!0,this._resetFilterOptions(),this._resetFilterArea(),this._elements.$searchTb.val(""),this._resetCheckboxes()}finally{this._ignoreEvents=!1}},t.prototype._resetFilterArea=function(){this._searchKey=undefined,this._elements.$filterOperatorsDdl.prop("selectedIndex",0).wijdropdown("refresh"),this._elements.$radioButtons.eq(1).prop("checked",!0).wijradio("refresh"),this._elements.$filterValuesDdl.val("").wijcombobox("option","selectedIndex",-1)},t.prototype._resetCheckboxes=function(){this._elements.$checkboxes.closest("li").show().end().prop("checked",!1).wijcheckbox("refresh"),this._elements.$searchTb.val("")},t.prototype._isSettingsChanged=function(e,t){return e.sortDirection!==t.sortDirection||this._compareArrays(e.filterValue,t.filterValue)||this._compareArrays(e.filterOperator,t.filterOperator,function(e,t){return e.name.toLowerCase()!==t.name.toLowerCase()||(e.condition||"or")!==(t.condition||"or")})},t.prototype._compareArrays=function(e,t,r){if(n.isArray(e)&&n.isArray(t)){if(e.length!==t.length)return!0;var i=!1,s,o;for(s=0,o=e.length;s<o&&!i;s++)i=this._compareArrays(e[s],t[s],r);return i}return r?r(e,t):e!==t},t.prototype._getDistinctDataValues=function(e,t){var r=[],i={};return e&&n.each(e,function(e,s){var o=s[t];n.isFunction(o)&&(o=o()),i[o]===undefined&&(i[o]=!0,r.push(o))}),r.sort(function(e,t){return e instanceof Date&&(e=e.getTime()),t instanceof Date&&(t=t.getTime()),e===t?0:e<t?-1:1})},t.prototype._createRoughDialog=function(){var e=this.options.wijCSS,t='<div class="wijmo-wijfilter-container"><div class="wijmo-wijfilter-headerContainer '+e.header+" "+e.cornerAll+" "+e.helperClearFix+'">'+'<span class="wijmo-wijfilter-headerText"></span>'+'<a class="wijmo-wijfilter-closeButton" href="#">Close</a>'+"</div>"+"<h3>Sort</h3>"+'<div class="wijmo-wijfilter-sortContainer">'+'<input type="checkbox" class="wijmo-wijfilter-ascendingButton" id="{0}" /><label for="{0}">Ascending</label>'+'<input type="checkbox" class="wijmo-wijfilter-descendingButton" id="{1}" /><label for="{1}">Descending</label>'+"</div>"+"<h3>Filter</h3>"+'<div class="wijmo-wijfilter-filterContainer">'+'<select class="wijmo-wijfilter-dropdown">'+"</select>"+'<input type="text" class="wijmo-wijfilter-combobox" />'+"</div>"+'<div class="wijmo-wijfilter-radioContainer">'+'<input type="radio" id="{2}" name="{4}" /><label for="{2}">And</label>'+'<input type="radio" id="{3}" name="{4}" checked="checked" /><label for="{3}">Or</label>'+"</div>"+'<div class="wijmo-wijfilter-filterContainer">'+'<select class="wijmo-wijfilter-dropdown">'+"</select>"+'<input type="text" class="wijmo-wijfilter-combobox" />'+"</div>"+'<div class="wijmo-wijfilter-searchContainer">'+'<input class="wijmo-wijfilter-text" type="text" /><span class="ui-icon ui-icon-search"></span>'+"</div>"+'<div class="wijmo-wijfilter-checkboxContainer ui-state-default">'+'<div><input id="{5}" type="checkbox" class="wijmo-wijfilter-selectAll" /><label for="{5}">(Select All)</label></div>'+"</div>"+'<a class="wijmo-wijfilter-clearButton" href="#">Clear Filter</a>'+'<div class="wijmo-wijfilter-actionContainer">'+'<a class="wijmo-wijfilter-applyButton" href="#">Apply</a>'+'<a class="wijmo-wijfilter-cancelButton" href="#">Cancel</a>'+"</div>"+"</div>";return t=function(e){var t=arguments;return e.replace(/{\d+}/g,function(e){return t[parseInt(e.replace(/[{}]/g,""),10)+1]})}(t,this._guid("ascBtn"),this._guid("descBtn"),this._guid("radioAnd"),this._guid("radioOr"),this._guid("radioGroup"),this._guid("selectAll")),n(t)},t.prototype._attachElements=function(e,t){var r=this._dialog,i=this.options.wijCSS,s=this,o;o=this._elements.$headerContainer=r.find(".wijmo-wijfilter-headerContainer"),this._elements.$headerText=o.find(".wijmo-wijfilter-headerText"),this._elements.$headerCloseBtn=o.find(".wijmo-wijfilter-closeButton"),o=this._elements.$sortContainer=r.find(".wijmo-wijfilter-sortContainer"),this._elements.$ascendingBtn=o.find(".wijmo-wijfilter-ascendingButton"),this._elements.$descendingBtn=o.find(".wijmo-wijfilter-descendingButton"),o=this._elements.$filterContainer=r.find(".wijmo-wijfilter-filterContainer"),this._elements.$filterOperatorsDdl=o.find(".wijmo-wijfilter-dropdown"),this._elements.$filterValuesDdl=o.find(".wijmo-wijfilter-combobox"),this._elements.$radioButtons=r.find(".wijmo-wijfilter-radioContainer input"),this._elements.$searchTb=r.find(".wijmo-wijfilter-searchContainer input"),this._elements.$checkboxContainer=r.find(".wijmo-wijfilter-checkboxContainer"),this._elements.$clearBtn=r.find(".wijmo-wijfilter-clearButton"),o=r.find(".wijmo-wijfilter-actionContainer"),this._elements.$applyBtn=o.find(".wijmo-wijfilter-applyButton"),this._elements.$cancelBtn=o.find(".wijmo-wijfilter-cancelButton"),this._elements.$headerCloseBtn.button({text:!1,icons:{primary:i.iconClose}}).click(function(){s.triggerClose(!1)}),this._elements.$ascendingBtn.button({text:!0,icons:{primary:"ui-icon-arrowthickstop-1-n"}}).click(n.proxy(s._onAscendingButtonClick,this)),this._elements.$descendingBtn.button({text:!0,icons:{primary:"ui-icon-arrowthickstop-1-s"}}).click(n.proxy(s._onDescendingButtonClick,this)),this._elements.$filterOperatorsDdl.append(n.map(t||[],function(e,t){var r=e.name.toLowerCase(),i=e.displayName||e.name;return n(new Option(i||e.name,r)).html(i)})).change(n.proxy(this._onFilterAreaChanged,this)).wijdropdown(),this._elements.$radioButtons.change(n.proxy(this._onRadioButtonChanged,this)).wijradio(),o=n.map(e,function(e,t){return{label:s._getDisplayValue(e)+"",value:s._getDisplayValue(e)}}),this._elements.$filterValuesDdl.change(n.proxy(this._onFilterAreaChanged,this)).wijcombobox({autoComplete:!1,data:o,changed:n.proxy(this._onFilterAreaChanged,this)}),this._elements.$searchTb.keyup(n.proxy(this._onSearchTextboxKeyUp,this)).wijtextbox(),this._elements.$checkboxContainer.append("<ul />").find("> ul").append(n.map(e,function(e,t){var r=s._guid("cb"),i=n("<li />"),o;return i.append(n('<input type="checkbox" id="'+r+'" dataidx="'+t+'" />')),i.append(o=n('<label for="'+r+'">'+"</label>")),o.text(s._getDisplayValue(e)+""),i[0]})),this._elements.$checkboxes=this._elements.$checkboxContainer.find("input").change(n.proxy(s._onCheckboxChange,this)).wijcheckbox(),this._elements.$clearBtn.button().click(function(){s._onClearButtonClick()}),this._elements.$applyBtn.button().click(function(){s._onApplyButtonClick()}),this._elements.$cancelBtn.button().click(function(){s.triggerClose(!1)})},t.prototype._fillDialog=function(){var e=this.options.filterOperator,t=this.options.filterValue,r=this,i;this.options.showHeader||this._elements.$headerContainer.hide(),this._elements.$headerText.html(this.options.title),this._elements.$sortContainer.find(".wijmo-wijfilter-"+this.options.sortDirection+"Button").prop("checked",!0),this._elements.$sortContainer.find("input").button("option","disabled",!this.options.enableSortButtons).button("refresh");var s=!0;n.each(e,function(e,t){return s=s&&(t.name||"").toLowerCase()==="equals"&&(t.condition||"or").toLowerCase()==="or"}),s&&t.length>1?n.each(t,function(e,t){n.isArray(t)&&(t=t[0]),typeof t=="string"&&(t=t.toLowerCase()),(i=n.inArray(t,r._distinctDataValuesCI))>=0&&n(r._elements.$checkboxes[i+1]).prop("checked",!0).wijcheckbox("refresh")}):(n.each(e,function(e,t){e<2&&r._elements.$filterOperatorsDdl.eq(e).val(t.name.toLowerCase()).wijdropdown("refresh")}),n.each(t,function(e,t){if(e<2){var n=r._elements.$filterValuesDdl.eq(e);n.wijcombobox("option","selectedValue",r._getDisplayValue(t[0])),n.val()||n.val(r._getDisplayValue(t[0])+"")}}),e.length>1&&e[1].condition==="and"&&this._elements.$radioButtons.eq(0).prop("checked",!0).wijradio("refresh"))},t.prototype._guid=function(e){return"wijfilter_"+(e||"")+t.prototype.guidValue++},t.prototype._resetFilterOptions=function(){this.options.filterValue=[[undefined]],this.options.filterOperator=[{name:"NoFilter"}]},t}(e.wijmoWidget);t.wijfilter=r,r.prototype.widgetEventPrefix="wijfilter",n.extend(r.prototype,{guidValue:0});var i=function(){function e(){this.wijCSS=undefined,this.data=undefined,this.dataKey=undefined,this.nullDisplayText="<null>",this.title="",this.enableSortButtons=!1,this.availableOperators=undefined,this.showHeader=!0,this.sortDirection=undefined,this.filterValue=[],this.filterOperator=[],this.close=null}return e}();r.prototype.options=n.extend(!0,{},e.wijmoWidget.prototype.options,new i),n.wijmo.registerWidget("wijfilter",r.prototype)})(e.filter||(e.filter={}));var t=e.filter})(wijmo||(wijmo={}));