var __extends=this.__extends||function(e,t){function n(){this.constructor=e}n.prototype=t.prototype,e.prototype=new n},wijmo;(function(e){(function(t){"use strict";var n=jQuery,r="wijvideo",i="wijmo-wijvideo",s="wijmo-wijvideo-wrapper",o="wijmo-wijvideo-controls",u="wijmo-wijvideo-play",a="wijmo-wijvideo-index",f="wijmo-wijvideo-index-slider",l="wijmo-wijvideo-timer",c="wijmo-wijvideo-volume",h="wijmo-wijvideo-volume-container",p="wijmo-wijvideo-volumeslider",d="wijmo-wijvideo-fullscreen",v="wijmo-wijvideo-container-fullscreen",m=function(e){function t(){e.apply(this,arguments)}return __extends(t,e),t.prototype._create=function(){var e=this,t,r,v,m,g,y=e.options,b=e.options.wijCSS;n(this.element).is("video")?this.$video=n(this.element):this.$video=n(this.element).find("video");if(!this.$video||this.$video.length===0||n.browser.msie&&parseInt(n.browser.version,10)<9)return;v=this.$video[0].canPlayType;if(!v)return;this.$video.wrap(n("<div></div>").addClass(i).addClass(b.wijvideo).addClass(b.content).addClass(b.widget)).after(n("<div></div>").addClass(s).addClass(b.wijvideoWrapper).append(n("<ul></ul>").addClass(o).addClass(b.wijvideoControls).addClass(b.header).addClass(b.helperClearFix).addClass(b.helperReset).append(n("<li></li>").addClass(u).addClass(b.wijvideoPlay).addClass(b.stateDefault).addClass(b.cornerAll).append(n("<span></span>").addClass(b.icon).addClass(b.iconPlay))).append(n("<li></li>").addClass(a).addClass(b.wijvideoIndex).append(n("<div></div>").addClass(f).addClass(b.wijvideoIndexSlider))).append(n("<li>00:00</li>").addClass(l).addClass(b.wijvideoTimer)).append(n("<li></li>").addClass(c).addClass(b.wijvideoVolume).addClass(b.stateDefault).addClass(b.cornerAll).append(n("<div></div>").addClass(h).addClass(b.wijvideoVolumeContainer).append(n("<div></div>").addClass(p).addClass(b.wijvideoVolumeSlider).addClass(b.stateDefault).addClass(b.cornerTop))).append(n("<span></span>").addClass(b.icon).addClass(b.iconVolumeOn))).append(n("<li></li>").addClass(d).addClass(b.wijvideoFullScreen).addClass(b.stateDefault).addClass(b.cornerAll).append(n("<span></span>").addClass(b.icon).addClass(b.iconArrow4Diag))))),this.$vidParent=this.$video.parent("."+i),this.$vidParent.width(this.$video.outerWidth()).height(this.$video.outerHeight()),this.$seekSlider=this.$vidParent.find("."+f),e._volumnOn=!0,e.$volumeBtn=this.$vidParent.find("."+c),g=e.$video.parent().find("."+o),m=window.setInterval(function(){e._getVideoAttribute("readyState")&&(window.clearInterval(m),e.$vidParent.width(e.$video.outerWidth()).height(e.$video.outerHeight()),g.show(),t=e.$vidParent.find("."+l).position().left,e.$seekSlider.width(t-e.$seekSlider.position().left-15),e.$seekSlider.slider({value:0,step:.01,max:e._getVideoAttribute("duration"),range:"min",stop:function(t,n){e.seek=!1,e._setVideoAttribute("currentTime",n.value)},slide:function(){e.seek=!0}}),e._updateTime(),e.$volumeSlider=e.$vidParent.find("."+p),e.$volumeSlider.slider({min:0,max:1,value:e._getVideoAttribute("volume"),step:.1,orientation:"vertical",range:"min",slide:function(t,n){e._setVideoAttribute("volume",n.value),n.value===0?(e._volumnOn=!1,e.$volumeBtn.find("span").removeClass(b.iconVolumeOn).addClass(b.iconVolumeOff)):(e._volumnOn=!0,e.$volumeBtn.find("span").removeClass(b.iconVolumeOff).addClass(b.iconVolumeOn))}}),g.css("display","none"),e._initialToolTip(),y.showControlsOnHover||(g.show(),e.$vidParent.height(e.$video.outerHeight()+g.height())))},200),this.$video.bind("click."+e.widgetName,function(){e._togglePlay()}),y.showControlsOnHover&&e.$vidParent.hover(function(){g.stop(!0,!0).fadeIn()},function(){g.delay(300).fadeOut()}),r=this.$vidParent.find("."+u+" > span"),r.click(function(){e._togglePlay()}).parent().hover(function(){n(this).addClass(b.stateHover)},function(){n(this).removeClass(b.stateHover)}),this.$vidParent.find("."+c).hover(function(){n("."+h).stop(!0,!0).slideToggle()}),this.$fullScreenBtn=this.$vidParent.find("."+d+" > span"),this.$fullScreenBtn.click(function(){e._toggleFullScreen()}).parent().hover(function(){n(this).addClass(b.stateHover)},function(){n(this).removeClass(b.stateHover)}),e.options.fullScreenButtonVisible||this.$vidParent.find("."+d).hide(),this.$volumeBtn.hover(function(){n(this).addClass(b.stateHover)},function(){n(this).removeClass(b.stateHover)}).click(function(){e._getVideoAttribute("readyState")&&(e._volumnOn=!e._volumnOn,e._volumnOn?(e.$volumeSlider.slider("value",e.currentVolumn?e.currentVolumn:1),e._setVideoAttribute("volume",e.currentVolumn?e.currentVolumn:1),e.$volumeBtn.find("span").removeClass(b.iconVolumeOff).addClass(b.iconVolumeOn)):(e.currentVolumn=e.$volumeSlider.slider("value"),e.$volumeSlider.slider("value",0),e._setVideoAttribute("volume",0),e.$volumeBtn.find("span").removeClass(b.iconVolumeOn).addClass(b.iconVolumeOff)))}),this.$video.bind("play."+e.widgetName,function(){r.removeClass(b.icon+" "+b.iconPlay).addClass(b.icon+" "+b.iconPause)}),this.$video.bind("pause."+e.widgetName,function(){r.removeClass(b.icon+" "+b.iconPause).addClass(b.icon+" "+b.iconPlay)}),this.$video.bind("ended."+e.widgetName,function(){e.pause()}),this.$video.bind("timeupdate."+e.widgetName,function(){e._updateTime()}),e._videoIsControls=!1,e._getVideoAttribute("controls")&&(e._videoIsControls=!0),this.$video.removeAttr("controls"),e.element.is(":hidden")&&e.element.wijAddVisibilityObserver&&e.element.wijAddVisibilityObserver(function(){e._refresh(),e.element.wijRemoveVisibilityObserver&&e.element.wijRemoveVisibilityObserver()},"wijvideo"),e.options.disabled&&e._handleDisabledOption(!0,e.element)},t.prototype._setOption=function(t,n){var r=this,i=r.options,s=r.$video.parent().find("."+o),u=r.$video.parent().find("."+u);e.prototype._setOption.call(this,t,n),t==="fullScreenButtonVisible"?(i.fullScreenButtonVisible=n,n?u.show():u.hide()):t==="disabled"?r._handleDisabledOption(n,r.element):t==="showControlsOnHover"&&(n?(this.$vidParent.height(this.$video.outerHeight()),s.hide(),r.$vidParent.hover(function(){s.stop(!0,!0).fadeIn()},function(){s.delay(300).fadeOut()})):(r.$vidParent.unbind("mouseenter mouseleave"),window.setTimeout(function(){s.show(),r.$vidParent.height(r.$video.outerHeight()+s.height())},200)))},t.prototype._handleDisabledOption=function(e,t){var r=this,i=r.$video.parent().find("."+o);e?(r.disabledDiv||(r.disabledDiv=r._createDisabledDiv(t)),r.disabledDiv.appendTo("body"),n.browser.msie&&(r.$vidParent.unbind("mouseenter mouseleave"),this.$video.unbind("click."+r.widgetName))):r.disabledDiv&&(r.disabledDiv.remove(),r.disabledDiv=null,n.browser.msie&&(r.$vidParent.hover(function(){i.stop(!0,!0).fadeIn()},function(){i.delay(300).fadeOut()}),this.$video.bind("click."+r.widgetName,function(){r._togglePlay()})))},t.prototype._createDisabledDiv=function(e){var t=this.$vidParent,r=t.offset(),i=t.outerWidth(),s=t.outerHeight();return n("<div></div>").addClass("ui-disabled").css({"z-index":"99999",position:"absolute",width:i,height:s,left:r.left,top:r.top})},t.prototype._getVideoAttribute=function(e){if(e==="")return;return this.$video.prop(e)},t.prototype._setVideoAttribute=function(e,t){if(e==="")return;return this.$video.prop(e,t)},t.prototype._initialToolTip=function(){var e=this,t=e.options.wijCSS;this.$seekSlider.wijtooltip({mouseTrailing:!0,showCallout:!1,position:{offset:"-60 -60"}}),this.$seekSlider.bind("mousemove",function(t,n){e._changeToolTipContent(t)}),this.$volumeBtn.wijtooltip({content:e._localizeString("volumeToolTip","Volume"),showCallout:!1}),this.$fullScreenBtn.wijtooltip({content:e._localizeString("fullScreenToolTip","Full Screen"),showCallout:!1}),this.$seekSlider.wijtooltip("widget").addClass(i).addClass(t.wijvideo),this.$volumeBtn.wijtooltip("widget").addClass(i).addClass(t.wijvideo),this.$volumeBtn.wijtooltip("widget").addClass(i).addClass(t.wijvideo)},t.prototype._updateTime=function(){var e=this,t=e._getVideoAttribute("duration"),n=e._getVideoAttribute("currentTime"),r,i,s="",o="";r=this._truncate((t-n)/60),i=this._truncate(t-n-r*60),r<10&&(s="0"),i<10&&(o="0"),this.$vidParent.find("."+l).html(s+r+":"+o+i),!this.seek&&this.$seekSlider.data("ui-slider")&&this.$seekSlider.slider("value",n)},t.prototype._truncate=function(e){return Math[e>0?"floor":"ceil"](e)},t.prototype._togglePlay=function(){var e=this;if(!e._getVideoAttribute("readyState"))return;e._getVideoAttribute("paused")?this.play():this.pause()},t.prototype._toggleFullScreen=function(){var e=this,t=e.options.wijCSS,r=e._getVideoAttribute("paused"),i=0,s=n(window).width(),o=n(window).height();this.fullScreen=!this.fullScreen,this.fullScreen?(e._oriVidParentStyle=this.$vidParent.attr("style"),e._oriWidth=this.$video.outerWidth(),e._oriHeight=this.$video.outerHeight(),e._oriDocOverFlow=n(document.documentElement).css("overflow"),n(document.documentElement).css({overflow:"hidden"}),e._replacedDiv||(e._replacedDiv=n("<div />")),this.$vidParent.after(e._replacedDiv),this.$vidParent.addClass(v).addClass(t.wijvideoContainerFullScreen).css({width:s,height:o}).appendTo(n("body")),this.$video.attr("width",s).attr("height",o),n(window).bind("resize.wijvideo",function(){e._fullscreenOnWindowResize()}),i=s-e._oriWidth):(n(document.documentElement).css({overflow:e._oriDocOverFlow}),i=e._oriWidth-this.$video.width(),e._replacedDiv.after(this.$vidParent).remove(),this.$vidParent.removeClass(v).removeClass(t.wijvideoContainerFullScreen).attr("style","").attr("style",e._oriVidParentStyle),this.$video.attr("width",e._oriWidth).attr("height",e._oriHeight),n(window).unbind("resize.wijvideo")),e._positionControls(i),e._hideToolTips(),r?e.pause():e.play()},t.prototype._fullscreenOnWindowResize=function(){var e=this,t=n(window).width(),r=n(window).height(),i=t-this.$vidParent.width();this.$vidParent.css({width:t,height:r}),this.$video.attr("width",t).attr("height",r),e._positionControls(i)},t.prototype._positionControls=function(e){var t=this.$vidParent.find("."+f);t.width(t.width()+e)},t.prototype._showToolTip=function(e){var t=this,n=e.pageX,r=e.pageY,i=this.$seekSlider.offset().left,s=this.$seekSlider.width(),o=n-i,u=t._getVideoAttribute("duration"),a;a=u*(o/s),this.$seekSlider.wijtooltip("option","content",t._getToolTipContent(a)),this.$seekSlider.wijtooltip("showAt",{x:n,y:r-10})},t.prototype._changeToolTipContent=function(e){var t=this,n=e.pageX,r=this.$seekSlider.offset().left,i=this.$seekSlider.width(),s=n-r,o=t._getVideoAttribute("duration"),u;u=o*(s/i),this.$seekSlider.wijtooltip("option","content",t._getToolTipContent(u))},t.prototype._hideToolTips=function(){this.$seekSlider.data("wijmoWijtooltip")&&this.$seekSlider.wijtooltip("hide"),this.$volumeBtn.data("wijmoWijtooltip")&&this.$volumeBtn.wijtooltip("hide"),this.$fullScreenBtn.data("wijmoWijtooltip")&&this.$fullScreenBtn.wijtooltip("hide")},t.prototype._localizeString=function(e,t){var n=this.options;return n.localization&&n.localization[e]?n.localization[e]:t},t.prototype._getToolTipContent=function(e){var t,n,r="",i="";return t=parseInt((e/60).toString(),10),n=parseInt((e-t*60).toString(),10),t<10&&(r="0"),n<10&&(i="0"),r+t+":"+i+n},t.prototype._refresh=function(){var e,t=this.$video.parent().find("."+o);t.show(),e=this.$vidParent.find("."+l).position().left,this.$seekSlider.width(e-this.$seekSlider.position().left-15),t.css("display","none"),this.options.showControlsOnHover||(t.show(),this.$vidParent.height(this.$video.outerHeight()+t.height()))},t.prototype.destroy=function(){var t=this;e.prototype.destroy.call(this),this.$vidParent.after(this.$video).remove(),this.$video.unbind("."+t.widgetName),t._videoIsControls&&t._setVideoAttribute("controls",!0)},t.prototype.play=function(){this.$video[0].play()},t.prototype.pause=function(){this.$video[0].pause()},t.prototype.getWidth=function(){return this.$video.outerWidth()},t.prototype.setWidth=function(e){e=e||600;var t=this.getWidth();this.$video.attr("width",e),this.$vidParent.width(this.$video.outerWidth()),this._positionControls(this.getWidth()-t)},t.prototype.getHeight=function(){return this.$video.outerHeight()},t.prototype.setHeight=function(e){e=e||400,this.$video.attr("height",e),this.options.showControlsOnHover?this.$vidParent.height(this.$video.outerHeight()):this.$vidParent.height(this.$video.outerHeight()+this.$video.parent().find("."+o).height())},t}(e.wijmoWidget);t.wijvideo=m;var g=function(){function e(){this.initSelector=":jqmData(role='wijvideo')",this.wijCSS={iconVolumeOn:"ui-icon-volume-on",iconVolumeOff:"ui-icon-volume-off",wijvideo:"",wijvideoWrapper:"",wijvideoControls:"",wijvideoPlay:"",wijvideoIndex:"",wijvideoIndexSlider:"",wijvideoTimer:"",wijvideoVolume:"",wijvideoVolumeContainer:"",wijvideoVolumeSlider:"",wijvideoFullScreen:"",wijvideoContainerFullScreen:""},this.fullScreenButtonVisible=!0,this.showControlsOnHover=!0,this.localization=null}return e}();m.prototype.options=n.extend(!0,{},e.wijmoWidget.prototype.options,new g),n.wijmo.registerWidget("wijvideo",m.prototype)})(e.video||(e.video={}));var t=e.video})(wijmo||(wijmo={}));