var __extends=this.__extends||function(e,t){function n(){this.constructor=e}n.prototype=t.prototype,e.prototype=new n},wijmo;(function(e){(function(e){var t=function(t){function n(){t.apply(this,arguments),this._skipUpdatePredicate=!1}return __extends(n,t),n.opNameMap={Greater:"GreaterThan",Less:"LessThan",GreaterOrEqual:"GreaterOrEqualThan",LessOrEqual:"LessOrEqualThan",BeginsWith:"StartsWith"},n.prototype.toPredicate=function(t){var r=null;return t&&typeof t=="object"&&e.util.each(t,function(e,t){var i=n.opNameMap[t.op.name]||t.op.name,s=new breeze.Predicate(e,i,t.value);r=r?r.and(s):s}),r},n.prototype.onFilterChanged=function(e){t.prototype.onFilterChanged.call(this,e),this._skipUpdatePredicate||(this.predicate=this.toPredicate(this._compiledFilter.normalized))},n.prototype.setFilter=function(e){if(!breeze.Predicate.isPredicate(e)){t.prototype.setFilter.call(this,e);return}this.predicate=e,this._skipUpdatePredicate=!0;try{t.prototype.setFilter.call(this,null)}finally{this._skipUpdatePredicate=!1}},n.prototype.applyToQuery=function(e,t,n){typeof t=="undefined"&&(t=!0),typeof n=="undefined"&&(n=!0);var r=this._compiledSort;this.predicate&&(e=e.where(this.predicate));if(!r.isEmpty){var i=$.map(r.normalized,function(e){return e.property+(e.asc?"":" desc")}).join(", ");e=e.orderBy(i)}return t&&(this._skip>0&&(e=e.skip(this._skip)),this._take>0&&(e=e.take(this._take)),n&&(e=e.inlineCount(!0))),e},n}(e.Shape);e.BreezeShape=t;var n=function(n){function r(t,r,i){n.call(this),this.query=t,this.manager=r,this.options=i,t||e.errors.argumentNull("query"),r||e.errors.argumentNull("manager"),this.entityType=r.metadataStore.getEntityType(t.resourceName,!0),this._shape.entityType=this.entityType,this._construct(i)}return __extends(r,n),r.prototype._construct=function(e){e=$.extend({inlineCount:!0},e),n.prototype._construct.call(this,e)},r._breezeDataTypeToString=function(t){return t?t==breeze.DataType.Decimal?"number":t.isNumeric?"number":t==breeze.DataType.String?"string":t==breeze.DataType.DateTime||t==breeze.DataType.Time?"datetime":t==breeze.DataType.Boolean?"boolean":null:null},r.prototype.getProperties=function(){return this.entityType&&this.entityType.dataProperties?$.map(this.entityType.dataProperties,function(e){return{name:e.name,type:r._breezeDataTypeToString(e.dataType)}}):this.entityType?this.entityType.dataProperties:[]},r.prototype._createShape=function(e){return new t(e)},r.prototype._remoteRefresh=function(){var t=this,n=$.Deferred();this.shapedQuery=this._shape.applyToQuery(this.query,!this.localPaging,this.options.inlineCount);var r=this._currentRequest={canceled:!1};return this.manager.executeQuery(this.shapedQuery).fail(function(t){t&&e.util.logError(t),n.reject(t)}).then(function(i){if(r.canceled)return;r===t._currentRequest&&(t._currentRequest=null),t.sourceArray=i.results,e.util.isNumeric(i.inlineCount)&&t._totalItemCount(i.inlineCount),t._localRefresh().then(n.resolve)}),n.promise()},r.prototype.cancelRefresh=function(){this._currentRequest&&(this._currentRequest.canceled=!0)},r.prototype._beginEdit=function(t,n){t.entityAspect||e.errors.breeze_notEntity(t)},r.prototype._currentItemHasChanges=function(){var e=this.currentEditItem(),t;if(!e.entityAspect)return!1;for(t in e.entityAspect.originalValues)if(this.getProperty(this.currentEditItem,t)!==e.entityAspect.originalValues[t])return!0;return!1},r.prototype._ensureEntity=function(t){return this.entityType||e.errors.breeze_entityTypeNotResolved(this.query.resourceName),t.entityAspect||(t=this.entityType.createEntity(t)),t},r.prototype.canAddNew=function(){return!!this.entityType},r.prototype.addNew=function(e){return typeof e=="undefined"&&(e={}),this.add(e)},r.prototype.add=function(e){return n.prototype.add.call(this,this._ensureEntity(e))},r.prototype.commitEdit=function(){var e=this.currentEditItem(),t=this.isCurrentEditItemNew,r=this._currentItemHasChanges();n.prototype.commitEdit.call(this),t?this.manager.addEntity(e):r&&e.entityAspect.setModified()},r.prototype.cancelEdit=function(){var e=this.currentEditItem();n.prototype.cancelEdit.call(this),e.entityAspect.setDeleted()},r.prototype._remove=function(e){var t=e.item.entityAspect;return t&&t.setDeleted(),n.prototype._remove.call(this,e)},r}(e.RemoteDataView);e.BreezeDataView=n,e.errors._register({breeze_entityTypeNotResolved:"Entity type {0} not resolved",breeze_notEntity:"{0} is not a Breeze entity"})})(e.data||(e.data={}));var t=e.data})(wijmo||(wijmo={}));